{
  "version": "1.0.0",
  "last_updated": "2026-02-06",
  "description": "Reglas paramétricas de BOM (Bill of Materials) por sistema constructivo. Permite calcular cantidades y costos de accesorios de forma determinista a partir de dimensiones.",
  "notes": [
    "Todas las fórmulas usan CEIL (ROUNDUP) salvo indicado",
    "Precios son IVA incluido (22%)",
    "Referencia de largo estándar perfiles: 3.00 m o 3.03 m",
    "Solape estándar perfilería: 50 mm (0.05 m)",
    "Desperdicio recomendado perfilería: 3%"
  ],

  "convenciones": {
    "unidades_permitidas": ["m2", "ml", "unit", "kit", "tubo", "rollo", "caja"],
    "redondeo_paneles": "CEIL",
    "redondeo_perfiles": "CEIL_to_largo_std",
    "redondeo_perfiles_nota": "CEIL_to_largo_std se implementa como CEIL(longitud_requerida_m / largo_perfil_std_m) en las fórmulas individuales",
    "redondeo_fijaciones": "CEIL",
    "iva_incluido": true,
    "iva_rate": 0.22,
    "moneda": "USD",
    "solape_perfiles_m": 0.05,
    "desperdicio_perfileria_pct": 3
  },

  "sistemas": {

    "techo_isoroof_3g": {
      "nombre": "Techo Liviano - ISOROOF 3G / FOIL / PLUS",
      "familias_compatibles": ["ISOROOF", "ISOROOF PLUS", "ISOROOF FOIL"],
      "composicion": "PIR",
      "uso": "techo",
      "ancho_util_m": 1.0,
      "espesores_disponibles_mm": [30, 40, 50, 80],
      "largo_perfil_std_m": 3.03,

      "formulas": {
        "panels_needed": {
          "formula": "CEIL(ancho_total_m / ancho_util_m)",
          "descripcion": "Cantidad de paneles por fila",
          "variables": {
            "ancho_total_m": "Ancho del área a cubrir",
            "ancho_util_m": 1.0
          }
        },
        "area_m2": {
          "formula": "largo_m * ancho_total_m",
          "descripcion": "Superficie total cubierta"
        },
        "gotero_frontal_pz": {
          "formula": "CEIL(ancho_total_m / largo_perfil_std_m) * 2",
          "descripcion": "Goteros frontales (frente + fondo)",
          "largo_perfil_std_m": 3.03,
          "nota": "1 gotero frontal arriba + 1 gotero frontal abajo (x2 lados)"
        },
        "gotero_lateral_pz": {
          "formula": "CEIL(largo_m / largo_perfil_std_m) * 2",
          "descripcion": "Goteros laterales (2 lados)",
          "largo_perfil_std_m": 3.0,
          "nota": "Un lateral por cada lado del techo"
        },
        "babeta_lateral_pz": {
          "formula": "CEIL(largo_m / largo_perfil_std_m) * 2",
          "descripcion": "Babetas laterales para cierre (2 lados)",
          "largo_perfil_std_m": 3.0
        },
        "babeta_superior_pz": {
          "formula": "CEIL(ancho_total_m / largo_perfil_std_m)",
          "descripcion": "Babeta superior (encuentro a muro si aplica)",
          "largo_perfil_std_m": 3.03,
          "condicional": "solo si hay encuentro a muro"
        },
        "cumbrera_pz": {
          "formula": "CEIL(ancho_total_m / largo_perfil_std_m)",
          "descripcion": "Cumbreras (si aplica, en techos a dos aguas)",
          "largo_perfil_std_m": 3.0,
          "condicional": "solo si techo a 2+ aguas"
        },
        "fijacion_paneles_unid": {
          "formula": "CEIL(((panels_needed * apoyos) * 2) + (largo_m * 2 / 2.5))",
          "descripcion": "Puntos de fijación del panel al soporte",
          "sub_formulas": {
            "apoyos": "CEIL((largo_m / autoportancia_m) + 1)"
          }
        },
        "arandelas_caballete_unid": {
          "formula": "fijacion_paneles_unid",
          "descripcion": "1 arandela/caballete por punto de fijación"
        },
        "tortugas_pvc_unid": {
          "formula": "fijacion_paneles_unid",
          "descripcion": "1 tortuga PVC por punto de fijación (sellado final)"
        },
        "arandelas_carrocero_unid": {
          "formula": "fijacion_paneles_unid",
          "descripcion": "1 arandela carrocero por punto (contención movimientos)"
        },
        "varilla_roscada_unid": {
          "formula": "CEIL(fijacion_paneles_unid / 4)",
          "descripcion": "Varillas roscadas (1 varilla cada 4 puntos)"
        },
        "tuercas_metal_unid": {
          "formula": "fijacion_paneles_unid * 2",
          "descripcion": "2 tuercas metal por punto de fijación"
        },
        "tuercas_hormigon_unid": {
          "formula": "fijacion_paneles_unid * 1",
          "descripcion": "1 tuerca hormigón por punto (si estructura hormigón)"
        },
        "tacos_hormigon_unid": {
          "formula": "fijacion_paneles_unid * 1",
          "descripcion": "1 taco expansivo por punto (si estructura hormigón)"
        },
        "remaches_unid": {
          "formula": "CEIL(total_perfiles_pz * 20)",
          "descripcion": "~20 remaches por pieza de perfil",
          "sub_formulas": {
            "total_perfiles_pz": "gotero_frontal_pz + gotero_lateral_pz + babeta_lateral_pz + babeta_superior_pz"
          }
        },
        "fijaciones_perfileria_unid": {
          "formula": "CEIL(total_ml_perfileria / 0.30)",
          "descripcion": "Fijaciones de perfilería, 1 cada 30cm",
          "sub_formulas": {
            "total_ml_perfileria": "(gotero_frontal_pz * 3.03) + (gotero_lateral_pz * 3.0) + (babeta_lateral_pz * 3.0)"
          }
        },
        "silicona_tubos": {
          "formula": "CEIL(perimetro_sellado_ml / rendimiento_tubo_ml)",
          "descripcion": "Tubos de silicona neutra",
          "sub_formulas": {
            "perimetro_sellado_ml": "(ancho_total_m * 2) + (largo_m * 2)",
            "rendimiento_tubo_ml": 8.0
          },
          "nota": "Rendimiento estimado: 8 ml por tubo para junta standard"
        }
      },

      "autoportancia": {
        "descripcion": "Tabla de cargas para ISOROOF - luz máxima entre apoyos",
        "tabla": [
          {"espesor_mm": 30, "luz_max_m": 2.5, "carga_admisible_kg_m2": 50},
          {"espesor_mm": 40, "luz_max_m": 3.0, "carga_admisible_kg_m2": 60},
          {"espesor_mm": 50, "luz_max_m": 3.5, "carga_admisible_kg_m2": 75},
          {"espesor_mm": 80, "luz_max_m": 5.0, "carga_admisible_kg_m2": 100}
        ],
        "validacion": {
          "formula": "luz_real_m <= luz_max_m",
          "si_no_cumple": "Sugerir espesor mayor o apoyo adicional intermedio"
        }
      }
    },

    "techo_isodec_eps": {
      "nombre": "Techo Pesado / Cubierta - ISODEC EPS",
      "familias_compatibles": ["ISODEC EPS", "ISOPANEL EPS"],
      "composicion": "EPS",
      "uso": "techo",
      "ancho_util_m": 1.12,
      "espesores_disponibles_mm": [100, 150, 200, 250],
      "largo_perfil_std_m": 3.03,

      "formulas": {
        "panels_needed": {
          "formula": "CEIL(ancho_total_m / ancho_util_m)",
          "variables": {"ancho_util_m": 1.12}
        },
        "area_m2": {
          "formula": "largo_m * ancho_total_m"
        },
        "gotero_frontal_pz": {
          "formula": "CEIL(ancho_total_m / 3.03) * 2",
          "nota": "Seleccionar SKU según espesor: 6838(100), 6839(150), 6840(200), 6841(250)"
        },
        "gotero_lateral_pz": {
          "formula": "CEIL(largo_m / 3.0) * 2",
          "nota": "Seleccionar SKU según espesor: 6842(100), 6843(150), 6844(200), 6845(250)"
        },
        "babeta_adosar_pz": {
          "formula": "CEIL(ancho_total_m / 3.0)",
          "condicional": "encuentro a muro"
        },
        "cumbrera_pz": {
          "formula": "CEIL(ancho_total_m / 3.03)",
          "condicional": "techo a 2 aguas"
        },
        "vaina_pz": {
          "formula": "CEIL(largo_m / 3.0)",
          "condicional": "sistema 2000"
        },
        "fijacion_paneles_unid": {
          "formula": "CEIL(((panels_needed * apoyos) * 2) + (largo_m * 2 / 2.5))",
          "sub_formulas": {
            "apoyos": "CEIL((largo_m / autoportancia_m) + 1)"
          }
        },
        "varilla_roscada_unid": {
          "formula": "CEIL(fijacion_paneles_unid / 4)"
        },
        "tuercas_metal_unid": {
          "formula": "fijacion_paneles_unid * 2"
        },
        "arandelas_carrocero_unid": {
          "formula": "fijacion_paneles_unid"
        },
        "tortugas_pvc_unid": {
          "formula": "fijacion_paneles_unid"
        },
        "remaches_unid": {
          "formula": "CEIL(total_perfiles_pz * 20)"
        },
        "silicona_tubos": {
          "formula": "CEIL(((ancho_total_m * 2) + (largo_m * 2)) / 8)"
        }
      },

      "autoportancia": {
        "descripcion": "Autoportancia ISODEC EPS - distancia entre correas",
        "tabla": [
          {"espesor_mm": 100, "luz_max_m": 5.5, "carga_admisible_kg_m2": 80},
          {"espesor_mm": 150, "luz_max_m": 7.5, "carga_admisible_kg_m2": 100},
          {"espesor_mm": 200, "luz_max_m": 9.0, "carga_admisible_kg_m2": 120},
          {"espesor_mm": 250, "luz_max_m": 10.5, "carga_admisible_kg_m2": 140}
        ],
        "validacion": {
          "formula": "luz_real_m <= luz_max_m",
          "si_no_cumple": "Sugerir espesor mayor o apoyo adicional"
        }
      }
    },

    "techo_isodec_pir": {
      "nombre": "Techo Pesado / Cubierta - ISODEC PIR (Ignífugo)",
      "familias_compatibles": ["ISODEC PIR"],
      "composicion": "PIR",
      "uso": "techo",
      "ancho_util_m": 1.12,
      "espesores_disponibles_mm": [50, 80, 120],
      "largo_perfil_std_m": 3.03,

      "formulas": {
        "panels_needed": {
          "formula": "CEIL(ancho_total_m / 1.12)"
        },
        "gotero_frontal_pz": {
          "formula": "CEIL(ancho_total_m / 3.03) * 2",
          "nota": "SKU: GF50DC(50), GF80DC(80), GF120DC(120)"
        },
        "gotero_lateral_pz": {
          "formula": "CEIL(largo_m / 3.0) * 2",
          "nota": "SKU: GL50DC(50), GL80DC(80), GL120DC(120)"
        },
        "babeta_adosar_pz": {
          "formula": "CEIL(ancho_total_m / 3.0)",
          "condicional": "encuentro a muro"
        },
        "fijacion_paneles_unid": {
          "formula": "CEIL(((panels_needed * apoyos) * 2) + (largo_m * 2 / 2.5))"
        },
        "varilla_roscada_unid": {
          "formula": "CEIL(fijacion_paneles_unid / 4)"
        },
        "remaches_unid": {
          "formula": "CEIL(total_perfiles_pz * 20)"
        },
        "silicona_tubos": {
          "formula": "CEIL(perimetro_ml / 8)"
        }
      },

      "autoportancia": {
        "tabla": [
          {"espesor_mm": 50, "luz_max_m": 3.5, "carga_admisible_kg_m2": 60, "nota": "EVITAR ESTE ESPESOR si posible"},
          {"espesor_mm": 80, "luz_max_m": 5.0, "carga_admisible_kg_m2": 80},
          {"espesor_mm": 120, "luz_max_m": 7.0, "carga_admisible_kg_m2": 100}
        ]
      }
    },

    "pared_isopanel_eps": {
      "nombre": "Pared / Fachada - ISOPANEL EPS",
      "familias_compatibles": ["ISOPANEL EPS"],
      "composicion": "EPS",
      "uso": "pared",
      "ancho_util_m": 1.14,
      "espesores_disponibles_mm": [50, 100, 150, 200, 250],
      "largo_perfil_std_m": 3.0,

      "formulas": {
        "panels_needed": {
          "formula": "CEIL(ancho_total_m / 1.14)"
        },
        "area_m2": {
          "formula": "largo_m * ancho_total_m",
          "nota": "Para paredes: largo = altura, ancho = largo de pared"
        },
        "perfil_u_inferior_pz": {
          "formula": "CEIL(ancho_total_m / 3.0)",
          "descripcion": "Perfil U base inferior",
          "nota": "Seleccionar por espesor del panel"
        },
        "perfil_u_superior_pz": {
          "formula": "CEIL(ancho_total_m / 3.0)",
          "descripcion": "Perfil U base superior"
        },
        "angulo_interior_pz": {
          "formula": "CEIL(largo_m / 3.0)",
          "descripcion": "Ángulo interior (esquinas)",
          "condicional": "por cada esquina interior"
        },
        "angulo_exterior_pz": {
          "formula": "CEIL(largo_m / 3.0)",
          "descripcion": "Ángulo exterior (esquinas)",
          "condicional": "por cada esquina exterior"
        },
        "fijacion_paneles_unid": {
          "formula": "CEIL((panels_needed * apoyos) * 2)",
          "descripcion": "Para pared, sin fijaciones de borde adicionales",
          "sub_formulas": {
            "apoyos": "CEIL((largo_m / autoportancia_m) + 1)"
          }
        },
        "remaches_unid": {
          "formula": "CEIL(total_perfiles_pz * 20)"
        },
        "silicona_tubos": {
          "formula": "CEIL(((ancho_total_m + largo_m) * 2) / 8)"
        }
      },

      "autoportancia": {
        "tabla": [
          {"espesor_mm": 50, "luz_max_m": 3.5, "carga_admisible_kg_m2": 40},
          {"espesor_mm": 100, "luz_max_m": 5.5, "carga_admisible_kg_m2": 60},
          {"espesor_mm": 150, "luz_max_m": 7.5, "carga_admisible_kg_m2": 80},
          {"espesor_mm": 200, "luz_max_m": 9.0, "carga_admisible_kg_m2": 100},
          {"espesor_mm": 250, "luz_max_m": 10.5, "carga_admisible_kg_m2": 120}
        ]
      }
    },

    "pared_isowall_pir": {
      "nombre": "Pared / Fachada - ISOWALL PIR (Ignífugo)",
      "familias_compatibles": ["ISOWALL PIR"],
      "composicion": "PIR",
      "uso": "pared",
      "ancho_util_m": 1.0,
      "espesores_disponibles_mm": [50, 80],
      "largo_perfil_std_m": 3.0,

      "formulas": {
        "panels_needed": {
          "formula": "CEIL(ancho_total_m / 1.0)"
        },
        "perfil_u_inferior_pz": {
          "formula": "CEIL(ancho_total_m / 3.0)"
        },
        "perfil_u_superior_pz": {
          "formula": "CEIL(ancho_total_m / 3.0)"
        },
        "fijacion_paneles_unid": {
          "formula": "CEIL((panels_needed * apoyos) * 2)"
        },
        "remaches_unid": {
          "formula": "CEIL(total_perfiles_pz * 20)"
        },
        "silicona_tubos": {
          "formula": "CEIL(perimetro_ml / 8)"
        }
      },

      "autoportancia": {
        "tabla": [
          {"espesor_mm": 50, "luz_max_m": 3.5, "carga_admisible_kg_m2": 50},
          {"espesor_mm": 80, "luz_max_m": 5.0, "carga_admisible_kg_m2": 70}
        ]
      }
    },

    "camara_frigorifica_isofrig": {
      "nombre": "Cámara Frigorífica - ISOFRIG PIR",
      "familias_compatibles": ["ISOFRIG"],
      "composicion": "PIR",
      "uso": "camara_frigorifica",
      "ancho_util_m": 1.14,
      "espesores_disponibles_mm": [40, 60, 80, 100, 150],
      "largo_perfil_std_m": 3.0,
      "temperatura_objetivo_c": -20,

      "formulas": {
        "panels_needed": {
          "formula": "CEIL(ancho_total_m / 1.14)"
        },
        "perfil_u_pz": {
          "formula": "CEIL(perimetro_m / 3.0) * 2",
          "descripcion": "Perfiles U arriba y abajo"
        },
        "fijacion_paneles_unid": {
          "formula": "CEIL((panels_needed * apoyos) * 2)"
        },
        "silicona_tubos": {
          "formula": "CEIL(total_juntas_ml / 6)",
          "nota": "Rendimiento menor por sellado hermético"
        },
        "cinta_butilo_rollos": {
          "formula": "CEIL(total_juntas_ml / 22.5)",
          "descripcion": "Cinta butilo para sellado de juntas"
        }
      }
    }
  },

  "terminaciones": {
    "_description": "Recargos y opciones de terminación",
    "colores_standard": ["Blanco", "Gris", "Gris Pizarra", "Terracota", "Rojo Teja"],
    "recargos": {
      "color_standard": {"recargo_pct": 0, "nota": "Sin recargo"},
      "color_especial": {"recargo_pct": 5, "nota": "Colores no estándar bajo pedido"},
      "galvanizado_prepintado": {
        "aluzinc": {"recargo_pct": 0},
        "prepintado": {"recargo_pct": 10, "nota": "Recargo por prepintado"}
      }
    },
    "espesores_chapa_mm": {
      "GP_0.5": {"descripcion": "Galvanizado prepintado 0.5mm", "standard": true},
      "GP_0.6": {"descripcion": "Galvanizado prepintado 0.6mm", "recargo_pct": 8},
      "ALUZINC_0.41": {"descripcion": "Aluzinc 0.41mm", "standard": true}
    }
  },

  "tabla_autoportancia_general": {
    "_descripcion": "Tabla unificada de autoportancia para lookup rápido",
    "por_producto": {
      "ISOROOF_30mm": {"luz_max_m": 2.5, "peso_kg_m2": 5.5},
      "ISOROOF_40mm": {"luz_max_m": 3.0, "peso_kg_m2": 6.0},
      "ISOROOF_50mm": {"luz_max_m": 3.5, "peso_kg_m2": 6.5},
      "ISOROOF_80mm": {"luz_max_m": 5.0, "peso_kg_m2": 7.5},
      "ISODEC_EPS_100mm": {"luz_max_m": 5.5, "peso_kg_m2": 12.0},
      "ISODEC_EPS_150mm": {"luz_max_m": 7.5, "peso_kg_m2": 13.5},
      "ISODEC_EPS_200mm": {"luz_max_m": 9.0, "peso_kg_m2": 15.0},
      "ISODEC_EPS_250mm": {"luz_max_m": 10.5, "peso_kg_m2": 16.5},
      "ISODEC_PIR_50mm": {"luz_max_m": 3.5, "peso_kg_m2": 10.0},
      "ISODEC_PIR_80mm": {"luz_max_m": 5.0, "peso_kg_m2": 11.5},
      "ISODEC_PIR_120mm": {"luz_max_m": 7.0, "peso_kg_m2": 13.0},
      "ISOPANEL_EPS_50mm": {"luz_max_m": 3.5, "peso_kg_m2": 9.0},
      "ISOPANEL_EPS_100mm": {"luz_max_m": 5.5, "peso_kg_m2": 10.5},
      "ISOPANEL_EPS_150mm": {"luz_max_m": 7.5, "peso_kg_m2": 12.0},
      "ISOPANEL_EPS_200mm": {"luz_max_m": 9.0, "peso_kg_m2": 13.5},
      "ISOPANEL_EPS_250mm": {"luz_max_m": 10.5, "peso_kg_m2": 15.0},
      "ISOWALL_PIR_50mm": {"luz_max_m": 3.5, "peso_kg_m2": 11.0},
      "ISOWALL_PIR_80mm": {"luz_max_m": 5.0, "peso_kg_m2": 12.5},
      "ISOFRIG_40mm": {"luz_max_m": 3.0, "peso_kg_m2": 10.0},
      "ISOFRIG_60mm": {"luz_max_m": 4.0, "peso_kg_m2": 11.0},
      "ISOFRIG_80mm": {"luz_max_m": 5.0, "peso_kg_m2": 12.0},
      "ISOFRIG_100mm": {"luz_max_m": 5.5, "peso_kg_m2": 13.0},
      "ISOFRIG_150mm": {"luz_max_m": 7.5, "peso_kg_m2": 15.0}
    }
  },

  "ejemplo_calculo": {
    "_descripcion": "Ejemplo: Techo ISODEC EPS 100mm, 5m largo x 11m ancho",
    "input": {
      "sistema": "techo_isodec_eps",
      "product_id": "ISODEC_EPS_100mm",
      "largo_m": 5.0,
      "ancho_total_m": 11.0,
      "espesor_mm": 100,
      "tiene_encuentro_muro": true,
      "tiene_cumbrera": false,
      "estructura": "metal"
    },
    "calculo_paso_a_paso": {
      "1_panels_needed": "CEIL(11.0 / 1.12) = 10 paneles",
      "2_area_m2": "5.0 * 11.0 = 55.0 m2",
      "3_autoportancia_check": "luz 5.0m <= 5.5m OK para 100mm",
      "4_apoyos": "CEIL((5.0 / 5.5) + 1) = 2",
      "5_fijacion_paneles": "CEIL(((10 * 2) * 2) + (5.0 * 2 / 2.5)) = CEIL(40 + 4) = 44",
      "6_gotero_frontal": "CEIL(11.0 / 3.03) * 2 = 4 * 2 = 8 piezas (SKU: 6838)",
      "7_gotero_lateral": "CEIL(5.0 / 3.0) * 2 = 2 * 2 = 4 piezas (SKU: 6842)",
      "8_babeta_encuentro_muro": "CEIL(11.0 / 3.0) = 4 piezas (SKU: 6828)",
      "9_varillas": "CEIL(44 / 4) = 11",
      "10_tuercas_metal": "44 * 2 = 88",
      "11_arandelas_carrocero": "44",
      "12_tortugas_pvc": "44",
      "13_remaches": "CEIL((8 + 4 + 4) * 20) = 320",
      "14_silicona": "CEIL(((11 * 2) + (5 * 2)) / 8) = CEIL(32 / 8) = 4 tubos"
    },
    "output_esperado": {
      "line_items": [
        {"sku": "IDEC100", "name": "ISODEC EPS 100mm", "unidad": "m2", "cant": 55.0, "precio_unit": 46.07, "total": 2533.85},
        {"sku": "6838", "name": "Gotero Frontal 100mm", "unidad": "unit", "cant": 8, "precio_unit": 19.12, "total": 152.96},
        {"sku": "6842", "name": "Gotero Lateral 100mm", "unidad": "unit", "cant": 4, "precio_unit": 25.34, "total": 101.36},
        {"sku": "6828", "name": "Babeta ISODEC Adosar", "unidad": "unit", "cant": 4, "precio_unit": 14.87, "total": 59.48},
        {"sku": "VR-3/8-1M", "name": "Varilla Roscada 3/8 1m", "unidad": "unit", "cant": 11, "precio_unit": 3.81, "total": 41.91},
        {"sku": "TUERCA-3/8", "name": "Tuerca BSW 3/8 Galv.", "unidad": "unit", "cant": 88, "precio_unit": 0.15, "total": 13.20},
        {"sku": "ARAN-CARR-3/8", "name": "Arandela Carrocero 3/8", "unidad": "unit", "cant": 44, "precio_unit": 0.79, "total": 34.76},
        {"sku": "TORTPVCBL", "name": "Tortugas PVC Blanco", "unidad": "unit", "cant": 44, "precio_unit": 3.00, "total": 132.00},
        {"sku": "RPOP", "name": "Remaches POP (unid)", "unidad": "unit", "cant": 320, "precio_unit": 0.04, "total": 12.80},
        {"sku": "Bromplast", "name": "Silicona Neutra x 600ml", "unidad": "tubo", "cant": 4, "precio_unit": 11.58, "total": 46.32}
      ],
      "subtotales": {
        "paneles": 2533.85,
        "perfileria": 313.80,
        "fijaciones": 234.67,
        "selladores": 46.32
      },
      "total_final_iva_inc": 3128.64
    }
  }
}
